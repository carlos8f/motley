#!/usr/bin/env node
var cmd = require('commander')
  , assert = require('assert')
  , fs = require('fs')
  , path = require('path')
  , ncp = require('ncp')
  , idgen = require('idgen')

cmd
  .usage('motley-init [path/to/project]')
  .version(require('../package.json').version)
  .option('--gist', 'initialize a new gist-friendly motley project')
  .description('initialize a new motley project')

cmd.parse(process.argv);

var dest = cmd.args[0] || '.';

var parts = [__dirname, '..', 'init'];
if (cmd.gist) parts[2] += '-gist';
var src = path.resolve.apply(path, parts);
ncp(src, dest, {clobber: false, stopOnErr: true}, function (err) {
  assert.ifError(err);
  var id = idgen();
  fs.readFile(path.join(dest, 'motley.yml'), {encoding: 'utf8'}, function (err, data) {
    assert.ifError(err);
    data = 'id: ' + id + '\n' + data;
    fs.writeFile(path.join(dest, 'motley.yml'), data, assert.ifError);
  });
});
